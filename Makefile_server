COMPFILE := docker/compose_prod.yml
COMP := compose -f $(COMPFILE)
EXEC := $(COMP) exec web
EXECDB := $(COMP) exec db
SERVER := htwserver-webapi
APPDIR := ~/api
SERVER_APP := $(SERVER):$(APPDIR)
RSYNC_COMMON := -rcv --exclude-from=.rsyncexclude
NOW := date -Is | sed "s/://g" | cut -d+ -f 1

up:
	docker $(COMP) up -d

logs:
	docker $(COMP) logs -f

down:
	docker $(COMP) down

restart_web:
	docker $(COMP) restart web

build:
	docker $(COMP) build

create:
	docker $(COMP) create

enter:
	docker $(EXEC) /bin/bash

migrate:
	docker $(EXEC) python manage.py migrate

check:
	docker $(EXEC) python manage.py check --deploy

test:
	docker $(EXEC) python manage.py test api

superuser:
	docker $(EXEC) python manage.py createsuperuser

copy_static:
	cp -r static_files/* /var/www/api_static_files/

dbbackup:
	docker $(EXECDB) /bin/bash -c 'pg_dump -U admin -F c multila > /data_backup/multila-`$(NOW)`.pgdump'
